;; Wifi ;;
(defwidget wifi-control []
  (eventbox :cursor "pointer"
  (box  :class "wifi-control"
        :orientation "vertical"
        :space-evenly "false"
    (button :class "wifi-icon-control"
            :onclick "~/.config/eww/scripts/wifi-menu.sh" wifi-strength))))

;; Volume ;;
(defwidget volume-control []
  (eventbox :cursor "pointer"
  (box  :class "volume-control"
        :orientation "horizontal"
        :space-evenly "false"
    (button :class "volume-icon-control"
            :onclick "~/.config/eww/scripts/easyeffects.sh" volume-icon))))

;; Volume Bar ;;
(defwidget volume-control-bar []
  (eventbox :cursor "pointer"
        (scale :class "volume-control-bar"
               :value current-volume
               :orientation "horizontal"
               :max 201
               :min 0
               :onchange "pactl set-sink-volume $(pactl get-default-sink) {}%")))


;; Brightness ;;
(defwidget brightness-control []
  (eventbox :cursor "pointer"
  (box  :class "brightness-control"
        :orientation "horizontal"
        :space-evenly "false"
    (button :class "brightness-icon-control"
            :onclick "" "󰖨"))))

;; Brightness Bar ;;
(defwidget brightness-control-bar []
  (eventbox :cursor "pointer"
        (scale :class "brightness-control-bar"
               :value current-brightness
               :orientation "horizontal"
               :max 101
               :min 0
               :onchange "brightnessctl s {}%")))

;; Bluetooth ;;
(defwidget bluetooth-control []
  (eventbox :cursor "pointer"
  (box  :class "bluetooth-control"
        :orientation "vertical"
        :space-evenly "false"
    (button :class "bluetooth-icon-control"
            :onclick "~/.config/eww/scripts/bluetuith.sh" bluetooth-status))))

;; Music Toggle Button ;;
(defwidget music-control []
  (eventbox :cursor "pointer"
    (box :class "music-control"
         :orientation "vertical"
         :space-evenly "false"
      (button :class "music-icon-control"
              :onclick "~/scripts/toggle-music-eww.sh" 
              "󰎆"))))

;; Idle ;;
(defwidget idle-control []
  (eventbox :cursor "pointer"
  (box  :class "idle-control"
        :orientation "vertical"
        :space-evenly "false"
    (button :class "idle-icon-control"
            :onclick "~/.config/eww/scripts/toggle-idle.sh" "󰖳"))))

;; Screenshot ;;
(defwidget screenshot-control []
  (eventbox :cursor "pointer"
    (box :class "screenshot-control"
         :orientation "vertical"
         :space-evenly "false"
      (button :class "screenshot-icon-control"
              :onclick "sh ~/scripts/gyazo-wayland-captura-menu-rofi &" 
              ""))))

;; Don't Disturb Button - Notificioanes [notis];;
(defwidget dnd-control []
  (eventbox :cursor "pointer"
    (box :class "dnd-control"
         :orientation "vertical"
         :space-evenly "false"
      (button :class "dnd-icon-control"
              :onclick "~/.config/eww/scripts/toggle-dnd.sh" 
              dnd-icon))))

;; Game Mode Button ;;
(defwidget game-mode-control []
  (eventbox :cursor "pointer"
    (box :class "game-mode-control"
         :orientation "vertical"
         :space-evenly "false"
      (button :class "game-mode-icon-control"
              :onclick "sh -c '~/.config/eww/scripts/toggle-game-mode.sh'"
              game-mode-icon))))

;; Night Mode Button ;;
(defwidget night-mode []
  (eventbox :cursor "pointer"
    (box :class "night-mode-control"
         :orientation "vertical"
         :space-evenly "false"
      (button :class "night-mode-icon-control"
              :onclick "sh -c '~/.config/eww/scripts/toggle-night-mode.sh'"
              night-mode-icon))))

;; Power Modes Menu Button
(defwidget power-mode-menu-control []
  (eventbox :cursor "pointer"
    (box :class "power-mode-menu-control"
         :orientation "vertical"
         :space-evenly "false"
      (button :class "power-mode-menu-icon-control"
              :onclick "hyprctl dispatch exec '~/.config/eww/scripts/power-modes-fuzzel.sh'"
              power-mode-icon))))

;; Volume Group ;;
(defwidget volume-controls []
  (box  :class "volume-controls"
        :orientation "horizontal"
        :space-evenly "false"
        :spacing 10
        :halign "start"
        :vexpand "false"
        :hexpand "false"
        (volume-control)
        (volume-control-bar)))

;; Brightness Group ;;
(defwidget brightness-controls []
  (box  :class "brightness-controls"
        :orientation "horizontal"
        :space-evenly "false"
        :spacing 10
        :halign "start"
        :vexpand "false"
        :hexpand "false"
        (brightness-control)
        (brightness-control-bar)))

;; Grid Control Group ;;
(defwidget toprow-controls []
  (box  :class "toprow-controls"
        :orientation "horizontal"
        :space-evenly "true"
        :spacing 10
        :halign "start"
        :vexpand "false"
        :hexpand "false"
        (wifi-control)      ;; Botón de WiFi
        (bluetooth-control)
        (idle-control)
        (screenshot-control)))

;; Grid Control Group - Fila Inferior
(defwidget bottomrow-controls []        ;; <-- ¡Añadido aquí! mi propio bottonrow. ~ By Dizzi
  (box :class "bottomrow-controls"
        :orientation "horizontal"
        :space-evenly "true"
        :spacing 10
        :halign "start"
        :vexpand "false"
        :hexpand "false"
        (power-mode-menu-control)  ;; ¡El nuevo menú único!
        (night-mode)
         (music-control)
        (game-mode-control)
        (dnd-control)))       ;; Botón de Música

;; Controls Group ;;
(defwidget controls []
  (box :class "controls"
       :orientation "vertical"
       :space-evenly "false"
       :spacing 8
       :halign "start"
       :vexpand "false"
       :hexpand "false"
       (bar-controls)
       (toprow-controls)
        (bottomrow-controls)))

;; Bar Group ;;
(defwidget bar-controls []
  (box :class "bar-controls"
       :orientation "vertical"
       :space-evenly "true"
       :spacing 8
       :halign "start"
       :vexpand "false"
       :hexpand "false"
       (volume-controls)
       (brightness-controls)))

        ;; device-control con revealer y header integrado
(defwindow device-control
  :monitor '[1, 0]'
  :geometry (geometry :x "0.8%"
                      :y "16px"
                      :width "10%"
                      :height "0%"
                      :anchor "top right")
  :stacking "overlay"
  :exclusive "false"
  :focusable "false"
  (box :class "device-control-wrapper"
       :orientation "vertical"
       :spacing 0
    
    ;; Trigger area con texto y ícono
;; Trigger area solo con texto
(eventbox :cursor "pointer"
          :onhover "eww update device-control-reveal=true"
          :class "trigger-area"
  (label :class "device-title"
        ;; :text "DEVICES"
        :text "dizzi ii"
         :halign "center"))    

    ;; Panel que se revela
    (revealer :reveal device-control-reveal
              :transition "slidedown"
              :duration "250ms"
      (eventbox :onhoverlost "eww update device-control-reveal=false"
        (controls)))))
