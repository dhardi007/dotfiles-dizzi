;;;;; Variables ;;;;;;
(deflisten workspaces :initial "[]" "sh ~/.config/eww/scripts/get-workspaces.sh")
(deflisten current_workspace :initial "1" "sh ~/.config/eww/scripts/get-active-workspace.sh")

(defvar power-vert false)
(defvar volume false)
(defvar brightness false)
(defvar battery false)
(defvar memory false)
(defvar launcher false)
(defvar device-control-reveal false)
(defvar wifi false)
(defvar music-control false)
(defvar calendar false)
(defvar eww "eww -c ~/.config/eww/")
;;;;;;;;;;;;;;;;;;;;;

;;;;; Deflistens ;;;;;
;; CAMBIADO: De 0.5s a 2s para música (reducir CPU)
(defpoll music :interval "2s" "playerctl metadata --format '{{ title }}' || true")
(defpoll artist :interval "2s" "playerctl metadata --format '{{ artist }}' || true")
(defpoll current-music-cover :interval "2s" "playerctl metadata --format {{mpris:artUrl}}")

;;;;; Defpolls Optimizados ;;;;;
(defpoll hour :interval "30s" "date '+%H'")  ;; Antes 10s → ahora 30s
(defpoll minute :interval "30s" "date '+%M'")

(defpoll adjustable-brightness :interval "24h" :initial "false" "~/.config/eww/scripts/is-brightness.sh")
(defpoll wallpapers :interval "30m" :initial "[1,7,8,9,12]" "~/.config/eww/scripts/get-wallpapers.sh")  ;; 10m → 30m
(defpoll has-battery :interval "24h" :initial "false" "~/.config/eww/scripts/is-battery.sh")
(defpoll clock :interval "30s" "date '+%H:%M'")  ;; 10s → 30s

;; CRÍTICO: Volumen y micrófono de 1s a 3s
(defpoll current-volume :interval "3s" :initial "0" "pactl get-sink-volume @DEFAULT_SINK@ | awk '{print $5}' | sed 's/%//'")
(defpoll current-microphone :interval "3s" :initial "0" "~/.config/eww/scripts/get-microphone.sh")

;; Brillo: Solo si es ajustable
(defpoll current-brightness :interval "3s" :initial "0" "echo $(( $(brightnessctl get) * 100 / $(brightnessctl max) ))")

;; Batería: De 15s a 30s es suficiente
(defpoll current-battery :interval "30s" :initial "0" "~/.config/eww/scripts/get-battery.sh")
(defpoll time-left :interval "60s" :initial "0" "~/.config/eww/scripts/get-time-left.sh")  ;; 15s → 60s

;; Sistema: 10s es razonable, pero podemos optimizar
(defpoll current-memory :interval "15s" :initial "0" "~/.config/eww/scripts/get-memory.sh")
(defpoll current-temperature :interval "15s" :initial "0" "~/.config/eww/scripts/get-temperature.sh")
(defpoll current-cpu :interval "15s" :initial "0" "~/.config/eww/scripts/get-cpu.sh")

;; Disco: Raramente cambia
(defpoll current-disk :interval "5m" :initial "0" "~/.config/eww/scripts/get-disk.sh")  ;; 1m → 5m
(defpoll current-disk-detail :interval "5m" :initial "0" "~/.config/eww/scripts/get-disk-detail.sh")
(defpoll current-memory-detail :interval "15s" :initial "0" "~/.config/eww/scripts/get-memory-detail.sh")

;; Música: De 1s a 3s
(defpoll current-music-seek :interval "3s" "~/.config/eww/scripts/get-music-seek.sh")
(defpoll mpris-cover :interval "3s" "~/.config/eww/scripts/mpris-cover.sh")
(defpoll update-cover-loop :interval "3s" "~/update-cover-loop.sh")

;; Red y Bluetooth: De 5s a 10s
(defpoll current-wifi :interval "10s" "~/.config/eww/scripts/get-network.sh")
(defpoll current-bluetooth :interval "10s" "~/.config/eww/scripts/get-bluetooth.sh")
(defpoll bluetooth-status :interval "10s" "~/.config/eww/scripts/get-bluetooth-status.sh")
(defpoll wifi-strength :interval "10s" "~/.config/eww/scripts/get-network-strength.sh")

;; Iconos de volumen y micrófono: 3s
(defpoll volume-icon :interval "3s" "~/.config/eww/scripts/get-volume-icons.sh")
(defpoll microphone-status :interval "3s" :initial "false" "~/.config/eww/scripts/get-microphone-status.sh")

;; Calendario: Raramente cambia
(defpoll calendar-day :interval "1h" "date '+%d'")  ;; 10h → 1h (por si cambia a medianoche)
(defpoll calendar-month :interval "1h" "~/.config/eww/scripts/get-month.sh")
(defpoll calendar-year :interval "1h" "date '+%Y'")
(defpoll calendar-short :interval "1h" "date '+%b %d, %Y'")

;; Hypridle: 2s es razonable
(defpoll idle :interval "5s" :initial "false" "~/.config/eww/scripts/get-hypridle-status.sh")

;; Modos: Solo cuando cambien (interval 0 significa "on-demand")
(defpoll dnd-icon :interval "5s" "~/.config/eww/scripts/get-dnd-icon.sh")
(defpoll power-mode-icon :interval "5s" "~/.config/eww/scripts/get-power-icon.sh")
(defpoll night-mode-icon :interval "5s" "~/.config/eww/scripts/get-nighmode-icon.sh")
(defpoll game-mode-icon :interval "5s" "~/.config/eww/scripts/get-gamemode-icon.sh")
;;;;;;;;;;;;;;;;;;;;

;; Widgets ;;
(include "widgets/bar.yuck")
(include "widgets/side-bar.yuck")
(include "widgets/wallpaper.yuck")
(include "widgets/resource-monitor.yuck")
(include "widgets/device-control.yuck")
(include "widgets/notifications.yuck")
(include "widgets/custom-calendar.yuck")
(include "widgets/music-control.yuck")
